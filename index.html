<html>
  <head>
    <meta charset='utf-8' />
    <title>Discord OAUTH</title>           
    <style>
      * {
        text-align: center;
        margin: 0px auto;
      }

      #welcome_txt {
        font-size: 24px;
      }

      #login-link {
        background-color: whitesmoke;
        border-radius: 8px;
        color: black;
        padding: 15px 30px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 20px;
      }

      #login-link:hover {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <br>
    <a id='login-link' href='https://discord.com/api/oauth2/authorize?client_id=954641697919369256&redirect_uri=https%3A%2F%2Fs10.brat.fun%2F&response_type=code&scope=identify%20email'>Login with Discord</a><br><br>
    <p id='welcome_txt'></p>
    <script>
      window.onload = function() {
        if (location.href.indexOf("code") !== -1) { // Detect if you logged in or not
          const code = location.href.substring(location.href.indexOf("code") + 5, location.href.length); // Get the code OAUTH gives you
          const request = new XMLHttpRequest(); // Create a new XMLHttpRequest
          request.open("POST", "http://localhost:7100/user"); // Open the XMLHttpRequest
          request.send(code); // Send the code in the request
          request.onload = () => { // Will run when the request is loaded
            if (request.status === 500) { // Error
              document.getElementById('welcome_txt').innerText = `There was an error with that. Please try logging in again. Error Code: ${request.status}`;
            } else if (request.status === 200) { // Successful
              document.getElementById("welcome_txt").innerText = `Welcome, ${req.responseText}!`
            } else { // Other
              document.getElementById('welcome_txt').innerText = `An error occured. Please try logging in again. Error Code: ${req.status}`;
            }
          }
        }
      }
    </script>
  </body>        
</html>
